<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/logo.png">
  
  <title>Make-headers - Zero Install</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../style.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Make-headers";
    var mkdocs_page_input_path = "tools/make-headers.md";
    var mkdocs_page_url = "/tools/make-headers/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Zero Install</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">About</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../comparison/">Comparison</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../faq/">FAQ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../features/">Features</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../perspectives/">Perspectives</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../troubleshooting/">Trouble-shooting</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Basics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../basics/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../basics/first-launch/">First launch</a>
                </li>
                <li class="">
                    
    <a class="" href="../../basics/making-shortcuts/">Making shortcuts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../basics/using-apps/">Using apps</a>
                </li>
                <li class="">
                    
    <a class="" href="../../basics/windows/">Desktop integration</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Details</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../details/">Manual walk-through</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/cache/">Cache and sharing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/cli/">Command-line interface</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/distribution-integration/">Distribution integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/export/">Export</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/file-locations/">File locations</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/os-differences/">OS-specific differences</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/policy-settings/">Policy settings</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/security/">Security</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/servers/">Servers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/sharing/">Sharing downloads between users</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/sync/">Sync</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/virtual-machines/">Virtual machines</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/windows/">Zero Install for Windows</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developers</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../developers/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/design/">Design</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/dotnet-api/">.NET API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/json-api/">JSON API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/python-api/">Python API</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/solver/">The Solver</a>
                </li>
                <li class="">
                    
    <a class="" href="../../developers/using-git/">Using Git</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Packaging</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../packaging/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../packaging/concepts/">Concepts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../packaging/guide-cli/">Packaging guide (command-line)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../packaging/guide-gui/">Packaging guide (graphical)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../packaging/local-feeds/">Local feeds</a>
                </li>
                <li class="">
                    
    <a class="" href="../../packaging/templates/">Templates</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Examples</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../packaging/examples/dotnet-lib/">.NET library</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../packaging/examples/find/">Find</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../packaging/examples/inkscape/">Inkscape</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../packaging/examples/rox/">ROX-Filer</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Specifications</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../specifications/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../specifications/capabilities/">Capabilities extension</a>
                </li>
                <li class="">
                    
    <a class="" href="../../specifications/catalog/">Catalog files</a>
                </li>
                <li class="">
                    
    <a class="" href="../../specifications/feed/">Feed files</a>
                </li>
                <li class="">
                    
    <a class="" href="../../specifications/manifest/">Manifest files</a>
                </li>
                <li class="">
                    
    <a class="" href="../../specifications/selections/">Selections files</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tools</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../0bootstrap/">0bootstrap</a>
                </li>
                <li class="">
                    
    <a class="" href="../0compile/">0compile</a>
                </li>
                <li class="">
                    
    <a class="" href="../0export/">0export</a>
                </li>
                <li class="">
                    
    <a class="" href="../0mirror/">0mirror</a>
                </li>
                <li class="">
                    
    <a class="" href="../0publish-win/">0publish-win</a>
                </li>
                <li class="">
                    
    <a class="" href="../0publish/">0publish</a>
                </li>
                <li class="">
                    
    <a class="" href="../0release/">0release</a>
                </li>
                <li class="">
                    
    <a class="" href="../0repo/">0repo</a>
                </li>
                <li class="">
                    
    <a class="" href="../0share/">0share</a>
                </li>
                <li class="">
                    
    <a class="" href="../0template/">0template</a>
                </li>
                <li class="">
                    
    <a class="" href="../0test/">0test</a>
                </li>
                <li class="">
                    
    <a class="" href="../0watch/">0watch</a>
                </li>
                <li class="">
                    
    <a class="" href="../ebox/">ebox</a>
                </li>
                <li class="">
                    
    <a class="" href="../feedlint/">FeedLint</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Make-headers</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#major-version-mappings">Major version mappings</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#library-versioning-on-linuxunix-systems">Library versioning on Linux/Unix systems</a></li>
        
            <li><a class="toctree-l4" href="#using-zero-install-dev-packages-with-distribution-runtime-packages">Using Zero Install -dev packages with distribution runtime packages</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../pkg2zero/">pkg2zero</a>
                </li>
                <li class="">
                    
    <span class="caption-text">0compile</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../0compile/chroot-build/">Chroot build</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../0compile/developers/">Developers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../0compile/example-scons/">Example: SCons</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">0release</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../0release/compiled-binaries/">Compiled binaries</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../0release/customisation/">Customisation</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Zero Install</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Tools &raquo;</li>
        
      
    
    <li>Make-headers</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/0install/docs/edit/master/docs/tools/make-headers.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><strong>Name:</strong> Make-headers<br />
<strong>Maintainer:</strong> Thomas Leonard<br />
<strong>License:</strong> GNU General Public License<br />
<strong>Source:</strong> <a href="http://repo.or.cz/w/make-headers.git">Git repository</a><br />
<strong>Zero Install feed:</strong> <a href="http://0install.net/2007/interfaces/Make-headers.xml">http://0install.net/2007/interfaces/Make-headers.xml</a></p>
<p><strong>Make-headers</strong> is an extremely simple script for creating <code>-dev</code> packages (packages containing only header files) from ordinary source releases. It performs the following steps:</p>
<ol>
<li>Runs <code>$SRCDIR/configure --prefix $DESTDIR &amp;&amp; make install</code></li>
<li>Notes the version numbers in any lib*.so symlinks (see below)</li>
<li>Deletes <code>$DESTDIR/{bin,man,share}</code>, any library binaries (<code>.so</code>, <code>.a</code> and <code>.la</code> files in <code>lib</code>), and any <code>lib/python</code>* directories.</li>
<li>Edits any pkg-config files (<code>lib/pkgconfig/*.pc</code>) to use a relative prefix of <code>${pcfiledir}/../..</code>.</li>
</ol>
<p>In other words, it does a full compile-and-install to $DESTDIR, deletes anything that isn't needed in a <code>-dev</code> package, and makes the result relocatable. It can be used as the compile command in a source implementation. For example, <a href="http://0install.net/2006/interfaces/GLib-dev">the GLib-dev feed</a> contains this entry:</p>
<pre><code class="xml">  &lt;group arch=&quot;*-src&quot; compile:command='&quot;$BUILD_COMMAND&quot;'&gt;
    &lt;implementation id=&quot;sha1new=fd1cf4afd14067866e626a2c91f9839f4639e604&quot;
                    released=&quot;2007-03-04&quot; stability=&quot;stable&quot;
            version=&quot;2.4.8&quot;&gt;
      &lt;archive extract=&quot;glib-2.4.8&quot;
               href=&quot;ftp://ftp.gtk.org/pub/gtk/v2.4/glib-2.4.8.tar.bz2&quot;
           size=&quot;2152755&quot;
           type=&quot;application/x-bzip-compressed-tar&quot;/&gt;
    &lt;/implementation&gt;
    &lt;requires interface=&quot;http://0install.net/2007/interfaces/Make-headers.xml&quot;&gt;
      &lt;environment insert=&quot;make-headers.py&quot; name=&quot;BUILD_COMMAND&quot;/&gt;
    &lt;/requires&gt;
</code></pre>

<p>This allows <a href="../0compile/">0compile</a> to create the GLib-dev package from the upstream source automatically.</p>
<p>Note: If your package creates script files in <code>bin</code> that are part of the <code>-dev</code> package (i.e. they are used when building programs that use the library) then use <code>--keep=bin</code> to prevent them from being deleted.</p>
<h1 id="major-version-mappings">Major version mappings</h1>
<p>There is a particular issue that comes up if you want to provide the header files (<code>*.h</code>) through Zero Install, but have the user get the run-time files (*.so) through their distribution. First, some background:</p>
<h2 id="library-versioning-on-linuxunix-systems">Library versioning on Linux/Unix systems</h2>
<p>The obvious way to store a shared library object in a package is to give it a simple name like <code>libfoo.so</code>. The packaging system selects which version of this file to use and the program loads it. Easy. This is how a pure Zero Install system would work.</p>
<p>However, in a traditional packaging system (apt, make install, etc), where library files go in a single directory (e.g. <code>/usr/lib</code>), this would make it impossible to have two versions of a library installed at once. As a special work-around, shared library objects include their version number in their name (e.g. <code>libfoo.so.1.2.3</code>). You (or your package manager) then adds two symlinks:</p>
<ul>
<li><code>libfoo.so</code> is the symlink used when compiling</li>
<li><code>libfoo.so.1</code> is the symlink used when running (here <code>1</code> is the "major" part of the version number from our example of <code>1.2.3</code>)</li>
</ul>
<p>The idea is that you make sure <code>libfoo.so</code> points to the correct version and then compile your code. The compiled binary takes the first part of the version number (here <code>1</code>) and stores <code>libfoo.so.1</code> as its dependency. When run, it uses the second symlink to find the actual library version. Minor (compatible) upgrades to the library have the same major version. For example, after installing a minor update the symlinks will point to <code>libfoo.so.1.3.0</code>, still with major version <code>1</code>.</p>
<p>For major (incompatible) changes, the major version number is changed. After installing a major upgrade (<code>2.0.0</code>), you have three symlinks:</p>
<ul>
<li><code>libfoo.so.1</code> to <code>libfoo.1.2.3</code> (from the previous version)</li>
<li><code>libfoo.so.2</code> to <code>libfoo.2.0.0</code></li>
<li><code>libfoo.so</code> to <code>libfoo.2.0.0</code></li>
</ul>
<p>Programs that need version 1 of the library can no longer be compiled (they try to use <code>libfoo.so</code> and fail), but any existing binaries will still run (they try to use <code>libfoo.so.1</code> and succeed). This is pretty horrible, but it's the way it works. The real problem is that the source code doesn't say what major version of the library it needs; it just fails to compile if you get it wrong, and you can only have the ability to compile against one version at a time.</p>
<p>Obviously, this scheme doesn't work in Zero Install, since installing a package is always side-effect-free. Preventing old programs from compiling would clearly be a side-effect.</p>
<p>In a pure Zero Install system, you can always use the simple scheme above and everything works correctly. In fact, to avoid changing existing libraries, we usually do include the version number in the library name, and we include both symlinks in the runtime package. This doesn't do any harm, because Zero Install keeps files from different packages in different places.</p>
<h2 id="using-zero-install-dev-packages-with-distribution-runtime-packages">Using Zero Install -dev packages with distribution runtime packages</h2>
<p>However, what if you want to combine both systems? That is, what if you want to get the header files through Zero Install but get the runtime shared object through your distribution's packaging system? Then there is a small problem. In Zero Install, we have:</p>
<ul>
<li>A library package contains the <code>libfoo.so</code> and <code>libfoo.so.version</code> files.</li>
<li>A <code>-dev</code> package contains the header files.</li>
</ul>
<p>In a distribution package:</p>
<ul>
<li>A library package contains the <code>libfoo.so.version</code> file only.</li>
<li>A <code>-dev</code> package contains headers and the <code>libfoo.so</code> file (only one <code>-dev</code> package can be installed at once).</li>
</ul>
<p>So, if you tried to use a Zero Install <code>-dev</code> package with a distribution library package, no one provides the <code>libfoo.so</code> file and the link fails.</p>
<p>To fix this, a Zero Install <code>-dev</code> package can specify the mappings from library names to major version numbers, like this:</p>
<pre><code class="shell">&lt;interface uri='.../libfoo-dev'&gt;
  ...
  &lt;implementation compile:lib-mappings=&quot;foo:1&quot; ... /&gt;
</code></pre>

<p>When 0compile compiles anything that depends on this <code>-dev</code> package, it searches for <code>libfoo.so.1</code> (provided by the distribution) in the library search path and creates a symlink to it named <code>libfoo.so</code> in a temporary directory, which it adds to the search path. Programs should then compile correctly without modifications. Multiple mappings can be given in the attribute, separated by spaces.</p>
<p>To be clear: a Zero Install source package depends on the library <code>-dev</code> package using the normal Zero Install mechanism (<code>&lt;requires ...&gt;</code> <code>&lt;version ...&gt;</code>). Having selected a suitable version of the <code>-dev</code> package, Zero Install uses the mappings inside it to work out what the compiled binary should link against.</p>
<p>The source for a <code>-dev</code> package can use <code>compile:binary-lib-mappings</code> to have this value placed in the generated <code>-dev</code> "binary" package. However, starting with version 0.3, Make-headers can automatically work out the correct values and add them to the feed.</p>
<p>In summary:</p>
<ul>
<li>If you are creating a source package that depends on a library, ignore all this and just put in a normal Zero Install dependency. 0compile will handle the mappings for you.</li>
<li>If you are publishing an existing <code>-dev</code> package for a library that isn't in Zero Install, remember add the <code>lib-mappings</code> attribute.</li>
<li>If you are publishing source for a <code>-dev</code> package, Make-headers should add the correct values for you automatically.</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pkg2zero/" class="btn btn-neutral float-right" title="pkg2zero">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../feedlint/" class="btn btn-neutral" title="FeedLint"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/0install/docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../feedlint/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../pkg2zero/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../menu.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
