<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/logo.png">
  
  <title>JSON API - Zero Install</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../style.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "JSON API";
    var mkdocs_page_input_path = "developers/json-api.md";
    var mkdocs_page_url = "/developers/json-api/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Zero Install</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">About</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../comparison/">Comparison</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../faq/">FAQ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../features/">Features</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../perspectives/">Perspectives</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../troubleshooting/">Trouble-shooting</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Basics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../basics/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../basics/first-launch/">First launch</a>
                </li>
                <li class="">
                    
    <a class="" href="../../basics/making-shortcuts/">Making shortcuts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../basics/using-apps/">Using apps</a>
                </li>
                <li class="">
                    
    <a class="" href="../../basics/windows/">Desktop integration</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Details</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../details/">Manual walk-through</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/cache/">Cache and sharing</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/cli/">Command-line interface</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/distribution-integration/">Distribution integration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/export/">Export</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/file-locations/">File locations</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/os-differences/">OS-specific differences</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/policy-settings/">Policy settings</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/security/">Security</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/servers/">Servers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/sharing/">Sharing downloads between users</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/sync/">Sync</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/virtual-machines/">Virtual machines</a>
                </li>
                <li class="">
                    
    <a class="" href="../../details/windows/">Zero Install for Windows</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developers</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../design/">Design</a>
                </li>
                <li class="">
                    
    <a class="" href="../dotnet-api/">.NET API</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">JSON API</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#introduction">Introduction</a></li>
    

    <li class="toctree-l3"><a href="#callbacks">Callbacks</a></li>
    

    <li class="toctree-l3"><a href="#operations">Operations</a></li>
    

    <li class="toctree-l3"><a href="#sample-code">Sample code</a></li>
    

    <li class="toctree-l3"><a href="#backwards-compatibility">Backwards compatibility</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../python-api/">Python API</a>
                </li>
                <li class="">
                    
    <a class="" href="../solver/">The Solver</a>
                </li>
                <li class="">
                    
    <a class="" href="../using-git/">Using Git</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Packaging</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../packaging/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../packaging/concepts/">Concepts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../packaging/guide-cli/">Packaging guide (command-line)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../packaging/guide-gui/">Packaging guide (graphical)</a>
                </li>
                <li class="">
                    
    <a class="" href="../../packaging/local-feeds/">Local feeds</a>
                </li>
                <li class="">
                    
    <a class="" href="../../packaging/templates/">Templates</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Examples</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../packaging/examples/dotnet-lib/">.NET library</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../packaging/examples/find/">Find</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../packaging/examples/inkscape/">Inkscape</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../packaging/examples/rox/">ROX-Filer</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Specifications</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../specifications/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../specifications/capabilities/">Capabilities extension</a>
                </li>
                <li class="">
                    
    <a class="" href="../../specifications/catalog/">Catalog files</a>
                </li>
                <li class="">
                    
    <a class="" href="../../specifications/feed/">Feed files</a>
                </li>
                <li class="">
                    
    <a class="" href="../../specifications/manifest/">Manifest files</a>
                </li>
                <li class="">
                    
    <a class="" href="../../specifications/selections/">Selections files</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tools</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../tools/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0bootstrap/">0bootstrap</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0compile/">0compile</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0export/">0export</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0mirror/">0mirror</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0publish-win/">0publish-win</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0publish/">0publish</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0release/">0release</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0repo/">0repo</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0share/">0share</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0template/">0template</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0test/">0test</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/0watch/">0watch</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/ebox/">ebox</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/feedlint/">FeedLint</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/make-headers/">Make-headers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tools/pkg2zero/">pkg2zero</a>
                </li>
                <li class="">
                    
    <span class="caption-text">0compile</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../tools/0compile/chroot-build/">Chroot build</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../tools/0compile/developers/">Developers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../tools/0compile/example-scons/">Example: SCons</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">0release</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../tools/0release/compiled-binaries/">Compiled binaries</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../tools/0release/customisation/">Customisation</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Zero Install</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Developers &raquo;</li>
        
      
    
    <li>JSON API</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/0install/docs/edit/master/docs/developers/json-api.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Starting with 0install 2.6, you can connect your programs to 0install via a JSON API. This is useful for writing 0install-based tools in other languages.</p>
<div class="toc">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#callbacks">Callbacks</a></li>
<li><a href="#operations">Operations</a></li>
<li><a href="#sample-code">Sample code</a></li>
<li><a href="#backwards-compatibility">Backwards compatibility</a></li>
</ul>
</div>
<h1 id="introduction">Introduction</h1>
<p>To use the JSON API, run <code>0install slave API-VERSION</code> (where <code>API-VERSION</code> is the latest protocol version you support), like this:</p>
<pre><code class="shell">$ 0install slave 2.7
0x00000031
[&quot;invoke&quot;,null,&quot;set-api-version&quot;,[&quot;2.6.2-post&quot;]]
</code></pre>

<p>0install responds first with a line indicating the length in octets of the JSON message to follow. All length headers sent by 0install are 11 octets long, including the leading "0x" and the trailing newline. After this comes the JSON message, giving the API version it will use. This will be the version you specified or the latest version it supports, whichever is smaller.</p>
<p>To invoke an operation, send the message <code>["invoke", myref, op, args]</code>, where <code>myref</code> is any string you choose, which will be attached to the reply, <code>op</code> is the operation to invoke and <code>args</code> are the arguments. Each message must start with a line giving the length in octets of the following message. For example, to ask 0install to select a set of components to run GnuPG:</p>
<pre><code class="plain">0x5d
[&quot;invoke&quot;, &quot;1&quot;, &quot;select&quot;, [{&quot;interface&quot;: &quot;http://repo.roscidus.com/security/gnupg&quot;}, false]]
</code></pre>

<p>All responses have the form <code>["return", myref, status, return-value]</code>, where <code>myref</code> lets you correlate this reply with the request you sent. The possible responses are <code>["ok", return-value]</code>, <code>["ok+xml", return-value]</code> and <code>["fail", error-message]</code>. In the case of <code>ok+xml</code>, the message is immediately followed by another length line and some XML. The above request might generate this response, which says to use the distribution's native version of GnuPG (2.0.22-2):</p>
<pre><code class="plain">0x0000002f
[&quot;return&quot;,&quot;1&quot;,&quot;ok+xml&quot;,[&quot;ok&quot;,{&quot;stale&quot;:false}]]
0x000001f5
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;selections interface=&quot;http://repo.roscidus.com/security/gnupg&quot; xmlns=&quot;http://zero-install.sourceforge.net/2004/injector/interface&quot;&gt;&lt;selection distributions=&quot;Arch Slack Debian RPM Gentoo Cygwin&quot; from-feed=&quot;distribution:http://repo.roscidus.com/security/gnupg&quot; id=&quot;package:arch:gnupg:2.0.22-2:x86_64&quot; interface=&quot;http://repo.roscidus.com/security/gnupg&quot; package=&quot;gnupg&quot; quick-test-file=&quot;/var/lib/pacman/local/gnupg-2.0.22-2/desc&quot; version=&quot;2.0.22-2&quot;/&gt;&lt;/selections&gt;
</code></pre>

<h1 id="callbacks">Callbacks</h1>
<p>In the process of handling your request, 0install may send its own invoke messages to you. You should be prepared to handle these messages:</p>
<dl>
<dt><code>set-api-version(version)</code></dt>
<dd>This is sent immediately at the start, indicating the protocol version to be used. The "myref" field is "null", indicating that no reply is expected. The version may be earlier than the version you requested, in which case you can either fall back to the earlier version or tell the user to upgrade.</dd>
<dt><code>confirm(message)</code></dt>
<dd>If 0install needs to ask the user to confirm something, it sends this message. This is used to confirm installation of distribution-provided packages, if any. Respond with success ("ok") and a return value of "ok" or "cancel". This is currently not used, because "select" does not require it.</dd>
<dt><code>confirm-keys(feed_url, keys)</code></dt>
<dd>A feed has been downloaded but has no trusted signature. Prompt the user to accept the keys. <code>keys</code> is a list of <code>(fingerprint, hints)</code> pairs, where <code>hints</code> is a list of <code>(vote, message)</code> hints from the key information server. Each vote is "good" or "bad". You should respond with a list of fingerprints which 0install should trust to sign updates for this domain. 0install will only ask you to confirm one feed at a time. Example:</dd>
</dl>
<pre><code class="plain">[&quot;invoke&quot;,&quot;1&quot;,&quot;confirm-keys&quot;,[
  &quot;http://repo.roscidus.com/lib/readline6&quot;,{
    &quot;DA9825AECAD089757CDABD8E07133F96CA74D8BA&quot;:[
      [&quot;good&quot;,&quot;Thomas Leonard created Zero Install and ROX.
      This key is used to sign updates to the injector; you should accept it.
      It was announced on the Zero Install mailing list on 2009-05-31.&quot;]]
    }]]
</code></pre>

<p>If the server is slow to respond, you will get a "pending" message instead, followed by a call to "update-key-info" later:</p>
<pre><code class="plain">[&quot;invoke&quot;,&quot;1&quot;,&quot;confirm-keys&quot;,[
  &quot;http://repo.roscidus.com/lib/readline6&quot;,{
    &quot;DA9825AECAD089757CDABD8E07133F96CA74D8BA&quot;:[&quot;pending&quot;]}]]
</code></pre>

<dl>
<dt><code>update-key-info</code></dt>
<dd>If the key information server is slow to respond, 0install may call <code>confirm-keys</code> before the hints have arrived. It will then send this message when the information arrives (or fails), so you can update the display. Note: the format here is a list of keys rather than a map. Example:</dd>
</dl>
<pre><code class="plain">[&quot;invoke&quot;,&quot;2&quot;,&quot;update-key-info&quot;,
  [&quot;DA9825AECAD089757CDABD8E07133F96CA74D8BA&quot;,[
    [&quot;bad&quot;,&quot;Error fetching key info: ...&quot;]]]]
</code></pre>

<p>If 0install is able to use its own GUI, it will use that rather than these callbacks. Start it with <code>--console</code> if you want to use your own GUI in all cases.</p>
<h1 id="operations">Operations</h1>
<p>Currently, only the <code>select</code> operation is supported (let us know if you want more; they're easy to add):</p>
<p><strong>select(requirements, refresh)</strong></p>
<p>Return a set of selections to run the given program. If <code>refresh</code> is <code>true</code>, 0install will always try to download a fresh copy of the feeds. Otherwise, it will reply immediately if possible. <code>requirements</code> is a JSON object with these keys (only <code>interface</code> is required):</p>
<dl>
<dt><code>interface</code></dt>
<dd>The URI of the program to run.</dd>
<dt><code>command</code></dt>
<dd>The <code>&lt;command&gt;</code> to run (e.g. <code>run</code>, <code>test</code>, <code>compile</code> or <code>null</code>).</dd>
<dt><code>source</code></dt>
<dd>Whether to select source code (and build dependencies) rather than a binary.</dd>
<dt><code>extra_restrictions</code></dt>
<dd>An object mapping interface URIs to version expressions, e.g. <code>{"http://repo.roscidus.com/python/python": "..!3"}</code> to require a version of Python less than 3.</dd>
<dt><code>os</code></dt>
<dd>Select implementations for the given OS (e.g. "Linux")</dd>
<dt><code>cpu</code></dt>
<dd>Select implementations for the given CPU (e.g. "x86_64" or "src")</dd>
<dt><code>message</code></dt>
<dd>A message to display if 0install uses its own GUI ("I need this because ...")</dd>
<dt><code>may_compile</code></dt>
<dd>(0install &gt;= 2.9; default <code>false</code>) Treat source implementations as potential binaries. If a source implementation is selected, it will be tagged with <code>requires-compilation="true"</code> to indicate this.</dd>
<dd>Returns <code>["ok",{"stale":stale-flag}]</code> on success. If stale-flag is true, the selections are based on old information. Consider using <code>refresh</code> to check for updates.</dd>
</dl>
<h1 id="sample-code">Sample code</h1>
<p>There is some <a href="https://github.com/0install/0install/blob/master/ocaml/sample_client.py">sample Python client code</a> available.</p>
<h1 id="backwards-compatibility">Backwards compatibility</h1>
<p>The text above documents the latest version of the protocol. The differences are:</p>
<dl>
<dt>2.6</dt>
<dd>In this version, <code>select</code> returns <code>"ok"</code> without the information about staleness.</dd>
</dl>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../python-api/" class="btn btn-neutral float-right" title="Python API">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../dotnet-api/" class="btn btn-neutral" title=".NET API"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/0install/docs/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../dotnet-api/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../python-api/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../menu.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
